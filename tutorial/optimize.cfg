# Prodigy DSPy Tutorial: Optimization Configuration
#
# This config is used by the dspy.optimize recipe to run a DSPy optimizer
# (GEPA) that tunes the program's prompts based on human feedback and metric.
#
# Usage:
#   prodigy dspy.optimize summaries_feedback ./optimize.cfg \
#     outputs/optimized_summarizer.json -F ./components.py

# ============================================================================
# DSPy Language Model Configuration
# ============================================================================
[dspy]
[dspy.lm]
# Base model for running the program during optimization
model = "openai/gpt-4o-mini"
max_tokens = 1500
temperature = 0.7


# ============================================================================
# Optimizer Configuration
# ============================================================================
[optimizer]
# DSPy optimizer to use for prompt optimization
# GEPA: Guided Exploration and Prompt Adaptation
# - Uses reflection to understand why predictions fail
# - Incorporates human feedback from evaluation step
# - Generates improved prompts
class = "GEPA"

# Auto parameter for GEPA
# "light" = minimal optimization (fewer examples required)
# "medium" = balanced optimization
# "heavy" = aggressive optimization (more examples/time required)
auto = "light"
num_threads = 1
# Specify a stronger model for reflection
# Reflection LM is used by GEPA to reason about failures
[optimizer.reflection_lm]
model = "openai/gpt-4o-mini"
temperature = 1.0
max_tokens = 1500


# ============================================================================
# Program Configuration
# ============================================================================
[program]
@dspy_programs = "clinical_summarization.v1"


# ============================================================================
# Metric Configuration
# ============================================================================
# Use the LLM-as-a-judge metric for better human alignment
# (or choose your preferred metric based on evaluation results)
[metric]
@dspy_metrics = "holistic_llm_metric.v1"

# Alternative: Use composite metric
# [metric]
# @dspy_metrics = "composite_ner_metric.v1"


# ============================================================================
# Data Converter Configuration
# ============================================================================

# Shared converter for all recipes
[to_dspy_converter]
# Convert Prodigy examples (with human feedback) to DSPy format
@dspy_converters = "prodigy_to_dspy.clinical_summary.v1"

# Alternative: Recipe-specific converter
# Use this if optimize needs different handling (e.g., special feedback formatting)
# [optimize_to_dspy_converter]
# @dspy_converters = "optimize_to_dspy.clinical_summary.v1"
